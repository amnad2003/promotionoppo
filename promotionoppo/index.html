<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OPPO Reno15 | Price & Promo</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header class="top">
  <h1>OPPO Reno15 Series</h1>
  <select id="storeSelect">
    <option value="banana">Banana</option>
    <option value="ais">AIS</option>
    <option value="true">True</option>
    <option value="jaymart">Jaymart</option>
  </select>
</header>

<main id="content"></main>

<script>
const content = document.getElementById("content");
const select = document.getElementById("storeSelect");
let storeData = null;

function loadStore(store){
  // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
  storeData = null;
  content.innerHTML = `<div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô...</div>`;

  // ‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏£‡πâ‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤
  const old = document.getElementById("storeScript");
  if(old) old.remove();

  // ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏£‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
  const script = document.createElement("script");
  script.src = `stores/${store}.js?v=${Date.now()}`;
  script.id = "storeScript";

  script.onload = () => {
    if(!storeData || !storeData.products || storeData.products.length === 0){
      content.innerHTML = `<div class="empty">‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>`;
      return;
    }
    render();
  };

  script.onerror = () => {
    content.innerHTML = `<div class="empty">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</div>`;
  };

  document.body.appendChild(script);
}

function render(){
  content.innerHTML = "";
  storeData.products.forEach(p=>{
    const sec = document.createElement("section");
    sec.className = "product";
    sec.innerHTML = `
      <h2>${p.name}</h2>
      ${p.variants.map(v=>`
        <div class="price">
          <span>${v.spec}</span>
          <b>${v.price.toLocaleString()}</b>
        </div>
      `).join("")}
      <ul class="promo">
        ${(p.promo || []).map(x=>`<li>üéÅ ${x}</li>`).join("")}
      </ul>
    `;
    content.appendChild(sec);
  });
}

select.onchange = () => loadStore(select.value);
loadStore(select.value);
</script>

</body>
</html>
