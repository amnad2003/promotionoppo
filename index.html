<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OPPO Reno15 | ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header class="top">
  <h1>OPPO Reno15 Series</h1>

  <div class="controls">
    <select id="storeSelect">
      <option value="banana">Banana</option>
      <option value="tg">TG</option>
      <option value="it_city">IT City</option>
      <option value="jaymart">Jaymart</option>
      <option value="TradeUp">Trade Up</option>
    </select>

    <input
      type="text"
      id="searchInput"
      placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏∏‡πà‡∏ô / ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô..."
    >
  </div>
</header>

<main id="content"></main>

<script>
const content = document.getElementById("content");
const select = document.getElementById("storeSelect");
const searchInput = document.getElementById("searchInput");

let storeData = null;
let keyword = "";

function loadStore(store){
  storeData = null;
  content.innerHTML = `<div class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô...</div>`;

  const old = document.getElementById("storeScript");
  if(old) old.remove();

  const script = document.createElement("script");
  script.src = `stores/${store}.js?v=${Date.now()}`;
  script.id = "storeScript";

  script.onload = () => {
    if(!storeData || !storeData.products?.length){
      content.innerHTML = `<div class="empty">‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>`;
      return;
    }
    render();
  };

  script.onerror = () => {
    content.innerHTML = `<div class="empty">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</div>`;
  };

  document.body.appendChild(script);
}

function render(){
  content.innerHTML = "";

  storeData.products
    .filter(p => {
      if(!keyword) return true;
      const text = (
        p.name +
        JSON.stringify(p.variants || []) +
        JSON.stringify(p.promo || [])
      ).toLowerCase();
      return text.includes(keyword);
    })
    .forEach(p => {
      const sec = document.createElement("section");
      sec.className = "product";

      sec.innerHTML = `
        <h2>${p.name}</h2>

        ${(p.variants || []).map(v=>`
          <div class="price">
            <span>${v.spec}</span>
            <b>${v.price?.toLocaleString() || "-"}</b>
          </div>
        `).join("")}

        ${(p.promo && p.promo.length) ? `
          <ul class="promo">
            ${p.promo.map(x=>`<li>üéÅ ${x}</li>`).join("")}
          </ul>
        ` : ""}
      `;
      content.appendChild(sec);
    });

  if(!content.children.length){
    content.innerHTML = `<div class="empty">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>`;
  }
}

select.onchange = () => loadStore(select.value);
searchInput.oninput = e => {
  keyword = e.target.value.toLowerCase();
  if(storeData) render();
};

loadStore(select.value);
</script>

</body>
</html>
